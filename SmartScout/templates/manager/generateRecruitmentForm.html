
{% extends "index.html" %}

{% block title %}Generate Recruitment Form{% endblock %}

{% block content %}
<div class="overflow-hidden bg-gray-900 h-screen">
    <div class="px-4 py-16 mx-auto sm:max-w-xl md:max-w-full lg:max-w-screen-xl md:px-24 lg:px-8 lg:py-20 h-full">
      <div class="flex flex-col items-center justify-center xl:flex-row h-full">
        <div class="w-full max-w-xl mb-12 xl:pr-16 xl:mb-0 xl:w-7/12">
          <h2 class="max-w-lg mb-6 font-sans text-3xl font-bold tracking-tight text-white sm:text-4xl sm:leading-none">
            Add Job Details
          </h2>
          <p class="max-w-xl mb-4 text-base text-gray-400 md:text-lg">
            Fill out the form below to post a job to the system.
          </p>
        </div>
        <div class="w-full max-w-xl xl:px-8 xl:w-5/12">
          <div class="relative">
            <svg viewBox="0 0 52 24" fill="white" class="absolute bottom-0 right-0 z-0 hidden w-32 -mb-8 -mr-20 text-teal-accent-400 lg:w-32 lg:-mr-16 sm:block">
              <defs>
                <pattern id="766323e1-e594-4ffd-a688-e7275079d540" x="0" y="0" width=".135" height=".30">
                  <circle cx="1" cy="1" r=".7"></circle>
                </pattern>
              </defs>
              <rect fill="url(#766323e1-e594-4ffd-a688-e7275079d540)" width="52" height="24"></rect>
            </svg>
            <div class="bg-zinc-950 text-white relative rounded shadow-2xl p-7 sm:p-10 h-full">
              <h3 class="mb-4 text-xl font-semibold sm:text-center sm:mb-6 sm:text-2xl">
                Job Details Form
              </h3>

              {% for field in form %}
                {% for error in field.errors %}
                  <p class="text-red-500 text-sm">{{ error }}</p>
                {% endfor %}
              {% endfor %}

              {% if error %}
              <p class="text-red-500 text-sm text-center">{{ error }}</p>
            {% endif %}

              <p class="text-red-500 text-sm text-center">{{ errors }}</p>
              <form method = 'post' class="h-full flex flex-col justify-between" id="jobForm">
                <!-- Job Detail -->
                 {% csrf_token %}




                <div class="mb-4">
                  <label for="jobDetail" class="block text-sm font-medium text-gray-500">Job Detail</label>
                  <textarea id="jobDetail" name="job_details" rows="4" class="w-full mt-2 bg-transparent px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm"></textarea>
                </div>
  
                <!-- Skills Required -->
                <div class="relative mb-4">
                  <label for="skillInput" class="block text-sm font-medium text-gray-500">Skills Required</label>
                  <div class="relative mt-2 flex items-center space-x-2">
                    <input 
                      type="text" 
                      id="skillInput"
                      class="flex-grow bg-transparent border border-gray-500 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2 outline-none"
                      placeholder="Type a skill..."
                    >
                    
                  </div>
                
                  <div id="autoSuggestContainer" 
                    class="absolute left-0 mt-2 w-full max-h-40 overflow-y-auto bg-gray-800 text-white border border-gray-600 rounded-md shadow-lg hidden z-10">
                  </div>
                </div>

                <div id="skillsContainer" class="mt-3 flex flex-wrap gap-2"></div>
                <input type="hidden" name="skills_required" id="skillsField">
  
                <!-- Expected Salary -->
                <div class="flex gap-2">
                  <div class="mb-4">
                      <label for="expectedSalary" class="block text-sm font-medium text-gray-500">Expected Salary</label>
                      <input type="number" id="expectedSalary" name="expected_salary" class="w-full mt-2 bg-transparent border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
      
                    <!-- Minimum Experience -->
                    <div class="mb-4">
                      <label for="minExperience" class="block text-[12px] font-medium text-gray-500">Minimum Experience</label>
                      <input type="number" id="minExperience" name="minimum_experience" class="w-full mt-2 bg-transparent border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
  
                <!-- Submit Button -->
                <div class="mt-4 mb-2 sm:mb-4">
                  <button type="submit" class="bg-blue-600 inline-flex items-center justify-center w-full h-12 px-6 font-medium tracking-wide text-white transition duration-200 rounded shadow-md hover:bg-deep-purple-accent-700 focus:outline-none">
                    Post Job
                  </button>
                </div>

                
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Card to display result -->
   
    
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
          const skillInput = document.getElementById('skillInput');
          const skillsContainer = document.getElementById('skillsContainer');
          const skillsField = document.getElementById('skillsField'); 
          const autoSuggestContainer = document.getElementById('autoSuggestContainer');
      
          let skills = [];
          let availableSkills = [];
      
          try {
              const response = await fetch('/static/json/skill.json');
              const data = await response.json();
              availableSkills = data.skills;
          } catch (error) {
              console.error("Error loading skills.json:", error);
          }
      
          // Show suggestions
          skillInput.addEventListener('input', () => {
              const query = skillInput.value.trim().toLowerCase();
              autoSuggestContainer.innerHTML = '';
              autoSuggestContainer.classList.remove('hidden');
      
              if (query) {
                  const filteredSkills = availableSkills.filter(skill => 
                      skill.toLowerCase().includes(query) && !skills.includes(skill)
                  );
      
                  filteredSkills.forEach(skill => {
                      const suggestion = document.createElement('div');
                      suggestion.className = 'px-3 py-2 cursor-pointer hover:bg-gray-700 transition';
                      suggestion.textContent = skill;
                      suggestion.addEventListener('click', () => {
                          addSkill(skill);
                          skillInput.value = '';
                          autoSuggestContainer.innerHTML = '';
                          autoSuggestContainer.classList.add('hidden');
                      });
                      autoSuggestContainer.appendChild(suggestion);
                  });
      
                  if (filteredSkills.length === 0) {
                      autoSuggestContainer.innerHTML = '<div class="px-3 py-2 text-gray-500">No matching skills</div>';
                  }
              } else {
                  autoSuggestContainer.classList.add('hidden');
              }
          });
      
          // Hide suggestions when clicking outside
          document.addEventListener('click', (e) => {
              if (!skillInput.contains(e.target) && !autoSuggestContainer.contains(e.target)) {
                  autoSuggestContainer.classList.add('hidden');
              }
          });
      
          // Add skill from input
          
      
          function addSkill(skill) {
              if (skill && availableSkills.includes(skill) && !skills.includes(skill)) {
                  skills.push(skill);
      
                  const skillItem = document.createElement('div');
                  skillItem.className = 'flex items-center space-x-2 bg-blue-600 text-white px-3 py-1 rounded-md shadow-md';
                  skillItem.innerHTML = `
                      <span>${skill}</span>
                      <button type="button" class="text-white opacity-70 hover:opacity-100 remove-skill">âœ–</button>
                  `;
      
                  skillItem.querySelector('.remove-skill').addEventListener('click', () => {
                      skills = skills.filter(s => s !== skill);
                      skillsContainer.removeChild(skillItem);
                      updateHiddenField();
                  });
      
                  skillsContainer.appendChild(skillItem);
                  skillInput.value = '';
                  autoSuggestContainer.classList.add('hidden');
                  updateHiddenField();
              } else {
                  alert(skill ? "Invalid or duplicate skill!" : "Enter a skill.");
              }
          }
      
          function updateHiddenField() {
              skillsField.value = JSON.stringify(skills);
          }
      });
      </script>
    
      
  </div>
{% endblock %}